# Radar2450 Library

Расширенная обертка для библиотеки HLK-LD2450 с фильтрацией, трекингом целей и сглаживанием данных.

![Radar2450](https://img.shields.io/badge/version-1.0.0-blue)
![Platform](https://img.shields.io/badge/platform-ESP32%20%7C%20ESP8266-green)
![License](https://img.shields.io/badge/license-MIT-yellow)

## ОСНОВНЫЕ ВОЗМОЖНОСТИ

- Экспоненциальное сглаживание координат целей
- Устойчивый трекинг целей с уникальными ID
- Расчет скорости в м/с и км/ч
- Настраиваемые ограничения по углу и дистанции
- Сортировка целей по расстоянию (ближайшие первые)
- Конфигурируемый коэффициент сглаживания
- Отладочная информация и статистика
- Совместимость с ESP32 и ESP8266

## ТРЕБОВАНИЯ К ОБОРУДОВАНИЮ

Библиотека `Radar2450` является расширением для библиотеки `HLK-LD2450` и требует ее установки. Датчик `HLK-LD2450` работает на частоте 24 ГГц и использует последовательное соединение на скорости 256000 бод. Рекомендуется использовать микроконтроллеры с аппаратным UART для стабильной работы.


## API

### Инициализация

Метод `begin` инициализирует радар с указанием пинов RX/TX и скорости UART.

```cpp
void begin(int rx_pin, int tx_pin, long baud_rate = 256000);
text

### Конфигурация

Методы для настройки параметров фильтрации и обработки данных.

#### Коэффициент сглаживания
```cpp
void setSmoothingFactor(float factor);//Устанавливает коэффициент экспоненциального сглаживания (0.0-1.0). Более высокие значения дают более плавное движение.
text

#### Максимальная дистанция
```cpp
void setMaxDistance(float distance); //Устанавливает максимальную дистанцию обнаружения целей (в метрах). Цели, находящиеся дальше указанной дистанции, будут игнорироваться.

#### Минимальная дистанция
```cpp
void setMinDistance(float distance);//Устанавливает минимальную дистанцию обнаружения целей (в метрах). Цели, находящиеся ближе указанной дистанции, будут игнорироваться.

#### Угловой фильтр
```cpp
void setAngleFilter(float min_angle, float max_angle);//Устанавливает угловой фильтр для обнаружения целей (в градусах). Цели, находящиеся вне указанного углового диапазона, будут игнорироваться. Угол измеряется от оси радара (0 градусов - прямо вперед).


### Получение данных

#### Количество активных целей
```cpp
int getActiveTargetCount();//Возвращает количество активных целей, обнаруженных радаром. Цели сортируются по расстоянию (ближайшая - первая). Возвращаемое значение от 0 до 3.

#### Дистанция до цели
```cpp
float getTargetDistance(int index);//Возвращает дистанцию до цели с указанным индексом (в метрах). Индекс начинается с 1 (ближайшая цель). Цели сортируются по расстоянию, поэтому цель с индексом 1 - ближайшая.


#### Угол цели
```cpp
float getTargetAngle(int index);//Возвращает угол цели с указанным индексом (в градусах). Положительные значения соответствуют правой стороне от радара, отрицательные - левой. Угол измеряется от оси радара (0 градусов - прямо вперед).


#### Координата X цели
```cpp
float getTargetX(int index);//Возвращает координату X цели с указанным индексом (в метрах). Координатная система: начало координат в радаре, ось X направлена вправо перпендикулярно оси радара.

#### Координата Y цели
```cpp
float getTargetY(int index);// Возвращает координату Y цели с указанным индексом (в метрах). Координатная система: начало координат в радаре, ось Y направлена вперед по оси радара.

#### Скорость цели (м/с)
```cpp
float getTargetSpeedMs(int index);//Возвращает скорость цели с указанным индексом в метрах в секунду. Положительные значения означают приближение к радару, отрицательные - удаление.

#### ID цели
```cpp
int getTargetID(int index);// Возвращает уникальный идентификатор (ID) цели с указанным индексом. ID присваивается цели при первом обнаружении и сохраняется для трекинга.

### Работа в основном цикле

#### Обновление данных радара
```cpp
void update();//Основной метод обновления данных радара. Должен вызываться в каждой итерации loop() для получения новых данных с датчика и обновления внутреннего состояния библиотеки.



### Отладка и статистика

#### Включение отладочного режима
```cpp
void enableDebug(bool enable);//Включает или отключает отладочный вывод. При включении в Serial будет выводиться дополнительная информация о работе библиотеки и состоянии целей.

#### Вывод отладочной информации
```cpp
void printDebugInfo();//Выводит в Serial отладочную информацию о текущем состоянии радара, включая параметры конфигурации, количество обнаруженных целей и их параметры.


```markdown
#### Частота обновления
```cpp
float getUpdateFrequency();//Возвращает текущую частоту обновления данных радара в герцах (Гц). Рассчитывается на основе времени между вызовами метода update.


```markdown
#### Счетчик кадров
```cpp
uint32_t getFrameCount();//Возвращает количество обработанных кадров данных с момента инициализации радара. Каждый вызов update, при котором получены новые данные, увеличивает счетчик.



## МИНИМАЛЬНЫЙ ПРИМЕР

### ПОДКЛЮЧЕНИЕ

Подключите датчик HLK-LD2450 к ESP32 согласно следующей схеме:

HLK-LD2450 ESP32
TX → GPIO16
RX → GPIO17
3.3V → 3.3V
GND → GND
text
**Примечание:** Убедитесь, что вы используете правильные пины UART на вашей плате ESP32. В примере используются GPIO16 (RX2) и GPIO17 (TX2) — второй аппаратный UART ESP32.


### УСТАНОВКА БИБЛИОТЕК

1. Установите библиотеку `HLK-LD2450` через Менеджер библиотек Arduino:
   - Откройте Arduino IDE
   - Перейдите в меню **Скетч → Подключить библиотеку → Управлять библиотеками...**
   - В поиске введите `HLK-LD2450`
   - Выберите библиотеку от `RBEGamer` и установите ее

2. Установите `Radar2450` как ZIP-библиотеку:
   - Скачайте архив библиотеки с GitHub
   - В Arduino IDE выберите **Скетч → Подключить библиотеку → Добавить .ZIP библиотеку...**
   - Выберите скачанный ZIP-файл

3. Для PlatformIO добавьте в файл `platformio.ini`:
   ```ini
   lib_deps = 
       eu1abg/Radar2450-Library
       RBEGamer/HLK-LD2450





### ПРИМЕР КОДА

```cpp
#include <Radar2450.h>

Radar2450 radar;

void setup() {
    Serial.begin(115200);
    radar.begin(16, 17);           // Инициализация радара на пинах 16 (RX) и 17 (TX)
    radar.setMaxDistance(6.0);     // Максимальная дистанция 6 метров
    radar.setSmoothingFactor(0.2); // Коэффициент сглаживания 0.2
}

void loop() {
    radar.update();                // Обновление данных с радара
    
    if (radar.getActiveTargetCount() > 0) {
        float dist = radar.getTargetDistance(1);   // Дистанция до ближайшей цели
        float angle = radar.getTargetAngle(1);     // Угол цели
        float speed = radar.getTargetSpeedKmh(1);  // Скорость цели в км/ч
        
        Serial.printf("Цель: %.1fм, %.0f°, %.1fкм/ч\n", dist, angle, speed);
    }
    
    delay(50);  // 20 Гц - оптимальная частота обновления
}

### ВЫВОД В СЕРИЙНЫЙ МОНИТОР

При запуске примера кода, в серийном мониторе с настроенной скоростью 115200 бод вы увидите данные о целях:

Цель: 2.5м, 15°, 1.2км/ч
Цель: 3.8м, -10°, 0.8км/ч


Каждая строка соответствует одной цели. Данные выводятся в формате:
- Дистанция в метрах (с одним десятичным знаком)
- Угол в градусах (целое число)
- Скорость в км/ч (с одним десятичным знаком)

Если целей нет, вывод не производится.

